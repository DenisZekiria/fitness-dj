<!DOCTYPE html>
<html lang="bg">
  <head>
    <meta charset="UTF-8" />
    <!-- –î–∞ –Ω–µ zoom-–≤–∞ —Å–ª—É—á–∞–π–Ω–æ, –∫–∞—Ç–æ –∞–ø–ø –∞ –Ω–µ –∫–∞—Ç–æ —Å–∞–π—Ç –¥–∞ –∏–∑–≥–ª–µ–∂–¥–∞ -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
	<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#121212">

    <title>Pro Fitness Timer & DJ</title>
    <style>
      :root {
        --bg-color: #121212;
        --text-color: #ffffff;
        --accent: #00e676; /* –ó–µ–ª–µ–Ω–æ –∑–∞ —Ä–∞–±–æ—Ç–∞ */
        --accent-rest: #ff1744; /* –ß–µ—Ä–≤–µ–Ω–æ –∑–∞ –ø–æ—á–∏–≤–∫–∞ */
        --card-bg: #1e1e1e;
        --highlight: #29b6f6;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      h1 {
        margin-bottom: 10px;
        font-size: 1.5rem;
        text-align: center;
      }

      /* Settings Panel */
      .settings {
        background: var(--card-bg);
        padding: 15px;
        border-radius: 10px;
        width: 100%;
        max-width: 400px;
        display: flex; /* –ü—Ä–æ–º–µ–Ω–µ–Ω–æ –æ—Ç grid –Ω–∞ flex */
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
        box-sizing: border-box;
      }

      .input-group {
        display: flex;
        flex-direction: column;
      }
      label {
        font-size: 0.8rem;
        color: #aaa;
        margin-bottom: 5px;
      }
      input[type="number"] {
        padding: 8px;
        background: #333;
        border: 1px solid #444;
        color: #fff;
        border-radius: 5px;
        font-size: 1.1rem;
        text-align: center;
      }

      /* Checkbox groups */
      .checkbox-group {
        grid-column: span 2;
        display: flex;
        flex-direction: column;
        gap: 8px;
        border-top: 1px solid #333;
        padding-top: 10px;
      }
      .cb-row {
        display: flex;
        align-items: center;
        justify-content: flex-start; /* –ü—Ä–æ–º–µ–Ω–µ–Ω–æ –Ω–∞ flex-start –∑–∞ –ø–æ–¥—Ä–∞–≤–Ω—è–≤–∞–Ω–µ –Ω–∞–ª—è–≤–æ */
        gap: 15px; /* –†–∞–∑—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–µ–∫—Å—Ç–∞ –∏ —á–µ–∫–±–æ–∫—Å–∞ */
      }
      .cb-row label {
        margin: 0;
        font-size: 0.9rem;
        color: #ddd;
      }
      input[type="checkbox"] {
        transform: scale(1.5);
        accent-color: var(--highlight);
      }

      /* Timer Display */
      .timer-display {
        text-align: center;
        margin-bottom: 20px;
        width: 100%;
        max-width: 400px;
        padding: 20px 0;
        border-radius: 15px;
        background: var(--card-bg);
        border: 3px solid var(--accent);
        transition: border-color 0.3s, background-color 0.3s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      }

      .status-text {
        font-size: 2rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 2px;
      }
      .time-text {
        font-size: 5.5rem;
        font-weight: bold;
        line-height: 1;
        margin: 10px 0;
        font-variant-numeric: tabular-nums;
      }
      .set-text {
        font-size: 1.2rem;
        color: #aaa;
      }

      .rest-mode {
        border-color: var(--accent-rest);
      }
      .rest-mode .status-text {
        color: var(--accent-rest);
      }
      .work-mode .status-text {
        color: var(--accent);
      }
      .finished-mode {
        border-color: var(--highlight);
      }
      .finished-mode .status-text {
        color: var(--highlight);
      }

      /* Controls */
      .controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        width: 100%;
        max-width: 400px;
      }

      button {
        padding: 15px 0;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        text-transform: uppercase;
        transition: transform 0.1s;
      }
      button:active {
        transform: scale(0.95);
      }

      .btn-start {
        background-color: var(--accent);
        color: #000;
        flex: 1;
      }
      .btn-stop {
        background-color: var(--accent-rest);
        color: #fff;
        flex: 1;
      }
      .btn-reset {
        background-color: #444;
        color: #fff;
        flex: 1;
      }

      /* Music Player */
      .player {
        width: 100%;
        max-width: 400px;
        background: var(--card-bg);
        padding: 15px;
        border-radius: 10px;
        box-sizing: border-box;
      }

      .file-input-wrapper {
        margin-bottom: 10px;
      }
      input[type="file"] {
        width: 100%;
        color: #aaa;
      }

      .now-playing {
        margin: 10px 0;
        font-style: italic;
        color: var(--highlight);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.9rem;
      }

      .playlist {
        max-height: 150px;
        overflow-y: auto;
        list-style: none;
        padding: 0;
        margin: 0;
        border-top: 1px solid #333;
      }

      .playlist li {
        padding: 10px;
        border-bottom: 1px solid #333;
        cursor: pointer;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
      }
      .playlist li:hover {
        background: #2a2a2a;
      }
      .playlist li.active {
        background: #333;
        color: var(--highlight);
        font-weight: bold;
      }

      audio {
        width: 100%;
        margin-top: 10px;
      }

      /* –°–∫—Ä–∏–≤–∞–Ω–µ –∏ –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ */
      .settings {
        transition: max-height 0.3s ease-out, opacity 0.3s ease-out,
          padding 0.3s;
        max-height: 1000px; /* –î–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –≥–æ–ª—è–º–æ —á–∏—Å–ª–æ */
        opacity: 1;
        overflow: hidden;
      }

      .settings.collapsed {
        max-height: 0;
        opacity: 0;
        padding: 0;
        margin: 0; /* –ú–∞—Ö–∞–º–µ –º–∞—Ä–¥–∂–∏–Ω–∞, –∫–æ–≥–∞—Ç–æ –µ –∑–∞—Ç–≤–æ—Ä–µ–Ω–æ */
        pointer-events: none;
        visibility: hidden; /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ –µ–ª–µ–º–µ–Ω—Ç—ä—Ç –Ω–µ –≤–ª–∏—è–µ –Ω–∞ –ø–æ–¥—Ä–µ–¥–±–∞—Ç–∞ */
      }

      .settings-toggle {
        background: transparent;
        border: 1px solid #444;
        color: var(--highlight);
        /* –ú–∞–ª—ä–∫ –≤–µ—Ä—Ç–∏–∫–∞–ª–µ–Ω (8px) –∏ –≥–æ–ª—è–º —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–Ω (40px) –ø–∞–¥–¥–∏–Ω–≥ –∑–∞ —à–∏—Ä–æ–∫ –≤–∏–¥ */
        padding: 8px 40px;
        margin: 10px auto 20px auto;

        /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–º–µ, —á–µ –Ω—è–º–∞ –¥–∞ —Å–µ —Ä–∞–∑–ø—ä–≤–∞ –Ω–∞–≥–æ—Ä–µ/–Ω–∞–¥–æ–ª—É */
        width: fit-content;
        height: fit-content;
        min-height: 0;

        display: flex;
        align-items: center;
        justify-content: center;

        cursor: pointer;
        font-size: 0.85rem;
        font-weight: bold;
        text-transform: uppercase;
        border-radius: 30px; /* –ó–∞–æ–±–ª–µ–Ω "pill" –¥–∏–∑–∞–π–Ω */
        transition: all 0.2s;
      }

      .settings-toggle:hover {
        background: rgba(41, 182, 246, 0.1);
        border-color: var(--highlight);
      }

      /* –¶–≤–µ—Ç–æ–≤–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å –±–∞—Ä–∞ —Å–ø–æ—Ä–µ–¥ —Ä–µ–∂–∏–º–∞ */
      .rest-mode #progressBar {
        background-color: var(--accent-rest) !important;
      }
      .work-mode #progressBar {
        background-color: var(--accent) !important;
      }
      .finished-mode #progressBar {
        width: 0% !important;
      }

      /* ---------- Theme variables: –¥–æ–±–∞–≤—è—Ç —Å–µ —Å–ª–µ–¥ :root ---------- */
      /* –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –æ—Å—Ç–∞–≤–∞–º–µ –≤ dark mode (–∫–∞–∫—Ç–æ –∏–º–∞—à –≤ :root),
		   –Ω–æ —Ç—É–∫ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–º–µ —è—Å–Ω–∞ light —Ç–µ–º–∞ –∏ –Ω—è–∫–æ–∏ –≥–ª–æ–±–∞–ª–Ω–∏ –ø–æ–ø—Ä–∞–≤–∫–∏. */

      .light-theme {
        --bg-color: #f7f7f8;
        --text-color: #0f1720;
        --card-bg: #ffffff;
        --input-bg: #ffffff;
        --input-border: #dcdcdc;
        --accent: #0077cc; /* —Å–∏–Ω –∞–∫—Ü–µ–Ω—Ç –∑–∞ –≤–∏–¥–∏–º–æ—Å—Ç –≤ —Å–≤–µ—Ç—ä–ª —Ä–µ–∂–∏–º */
        --accent-rest: #c62828;
        --highlight: #0b84ff;
        --muted: #6b7280;
        --panel-shadow: 0 6px 18px rgba(16, 24, 40, 0.06);
        --progress-bg: #e6e6e6;
      }

      .dark-theme {
        /* –ú–æ–∂–µ—à –¥–∞ –æ—Å—Ç–∞–≤–∏—à —Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –æ—Ç :root (–≤–µ—á–µ —Å–∞ —Ç—ä–º–Ω–∏),
			 –Ω–æ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–º–µ —è–≤–Ω–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –∑–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç */
        --bg-color: #121212;
        --text-color: #ffffff;
        --card-bg: #1e1e1e;
        --input-bg: #2b2b2b;
        --input-border: #444;
        --accent: #00e676;
        --accent-rest: #ff1744;
        --highlight: #29b6f6;
        --muted: #9ca3af;
        --panel-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        --progress-bg: #2a2a2a;
      }

      /* –ü–ª–∞–≤–µ–Ω –ø—Ä–µ—Ö–æ–¥ –ø—Ä–∏ —Å–º—è–Ω–∞ –Ω–∞ —Ç–µ–º–∞ */
      body {
        transition: background-color 240ms ease, color 240ms ease;
      }

      /* Theme toggle button */
      .theme-toggle-wrapper {
        width: 100%;
        max-width: 400px;
        display: flex;
        justify-content: flex-end;
        margin-bottom: 8px;
        box-sizing: border-box;
      }
      .theme-toggle-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--input-border);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.02)
        );
        cursor: pointer;
        font-size: 1rem;
        line-height: 1;
        transition: background 160ms, border-color 160ms, transform 80ms;
        color: var(--text-color);
      }
      .theme-toggle-btn:active {
        transform: scale(0.98);
      }
      .theme-toggle-btn:focus {
        outline: 3px solid rgba(11, 132, 255, 0.18);
        outline-offset: 2px;
      }

      /* Icons inside button: –ø–æ–∫–∞–∑–≤–∞–º–µ/—Å–∫—Ä–∏–≤–∞–º–µ —Å–ø—Ä—è–º–æ —Ç–µ–º–∞ */
      .icon-sun,
      .icon-moon {
        display: inline-block;
      }
      .light-theme .icon-sun {
        opacity: 1;
        transform: translateY(0);
      }
      .light-theme .icon-moon {
        opacity: 0.35;
        transform: translateY(0);
      }
      .dark-theme .icon-sun {
        opacity: 0.35;
        transform: translateY(0);
      }
      .dark-theme .icon-moon {
        opacity: 1;
        transform: translateY(0);
      }

      /* Visually hidden for screen readers */
      .visually-hidden {
        position: absolute !important;
        height: 1px;
        width: 1px;
        overflow: hidden;
        clip: rect(1px, 1px, 1px, 1px);
        white-space: nowrap;
      }

      /* Override –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –º–µ—Å—Ç–∞ –≤ —Ç–≤–æ—è —Å—Ç–∏–ª, –∑–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—Ç –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏—Ç–µ: */
      input[type="number"],
      input[type="file"] {
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        color: var(--text-color);
      }
      .settings {
        background: var(--card-bg);
        box-shadow: var(--panel-shadow);
      }
      .timer-display {
        background: var(--card-bg);
        color: var(--text-color);
      }
      .player {
        background: var(--card-bg);
        color: var(--text-color);
        box-shadow: var(--panel-shadow);
      }
      .now-playing {
        color: var(--highlight);
      }

      /* Playlist hover/active */
      .playlist li:hover {
        background: color-mix(in srgb, var(--highlight) 10%, transparent);
      }
      .playlist li.active {
        background: color-mix(in srgb, var(--highlight) 12%, transparent);
        color: var(--highlight);
      }

      /* Buttons: ensure contrast with text */
      .btn-start {
        background-color: var(--accent);
        color: var(--text-color);
      }
      .btn-stop {
        background-color: var(--accent-rest);
        color: var(--text-color);
      }
      .btn-reset {
        background-color: color-mix(in srgb, var(--text-color) 8%, transparent);
        color: var(--text-color);
      }

      /* Progress bar base */
      .progress-container {
        background: var(--progress-bg);
        border-color: var(--input-border);
      }
      /* Ensure progress text contrast */
      #progressPercent {
        color: var(--text-color);
        text-shadow: none;
      }

      /* Accessibility: focus for interactive list items */
      .playlist li:focus {
        outline: 2px solid rgba(11, 132, 255, 0.18);
        outline-offset: -2px;
      }

      /* Small responsiveness for toggle (mobile) */
      @media (max-width: 420px) {
        .theme-toggle-wrapper {
          justify-content: center;
          margin-bottom: 6px;
        }
      }

      /* Header: h1 + theme toggle –Ω–∞ –µ–¥–∏–Ω —Ä–µ–¥ */
      .header-row {
        width: 100%;
        max-width: 400px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 10px;
      }

      .header-row h1 {
        margin: 0;
        font-size: 1.6rem;
        line-height: 1.2;
        text-align: left;
        flex: 1;
      }

      /* –ù–∞ –º–Ω–æ–≥–æ –º–∞–ª–∫–∏ –µ–∫—Ä–∞–Ω–∏ ‚Äì –∑–∞–ø–∞–∑–≤–∞–º–µ —á–µ—Ç–∏–º–æ—Å—Ç */
      @media (max-width: 380px) {
        .header-row h1 {
          font-size: 1.4rem;
        }
      }

      /* Light theme: –ø–æ-–¥–æ–±—Ä–∞ —á–µ—Ç–∏–º–æ—Å—Ç –Ω–∞ checkbox —Ç–µ–∫—Å—Ç–æ–≤–µ—Ç–µ */
      .light-theme label {
        color: #2f2f2f; /* —Ç—ä–º–Ω–æ —Å–∏–≤–æ ‚Äì –ø–æ-–º–µ–∫–æ –æ—Ç —á–∏—Å—Ç–æ —á–µ—Ä–Ω–æ */
      }

      /* –°–∞–º–∏—Ç–µ —á–µ–∫–±–æ–∫—Å–æ–≤–µ */
      .light-theme input[type="checkbox"] {
        accent-color: #555; /* —Ç—ä–º–Ω–æ —Å–∏–≤–æ, –Ω–µ —á–µ—Ä–Ω–æ */
      }

      button,
      input[type="checkbox"] {
        touch-action: manipulation; /* –ü—Ä–µ–º–∞—Ö–≤–∞ –∑–∞–±–∞–≤—è–Ω–µ—Ç–æ –ø—Ä–∏ —Ç–∞–ø–≤–∞–Ω–µ –Ω–∞ –º–æ–±–∏–ª–Ω–∏ */
        -webkit-tap-highlight-color: transparent; /* –ú–∞—Ö–∞ —Å–∏–Ω–∏–æ—Ç–æ –∫–≤–∞–¥—Ä–∞—Ç—á–µ –ø—Ä–∏ —Ç–∞–ø */
      }

      /* Player Controls - –ì–æ–ª–µ–º–∏ –±—É—Ç–æ–Ω–∏ –∑–∞ —Ç–µ–ª–µ—Ñ–æ–Ω */
      .player-controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        justify-content: space-between;
      }

      .player-btn {
        background: #333;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 12px;
        font-size: 1.2rem;
        flex: 1;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .player-btn:active {
        background: #555;
        transform: scale(0.95);
      }

      /* –ê–∫—Ç–∏–≤–µ–Ω Shuffle –±—É—Ç–æ–Ω */
      .btn-shuffle.active {
        color: var(--highlight);
        background: rgba(41, 182, 246, 0.15);
        border: 1px solid var(--highlight);
      }
	  
	  /* –°–∫—Ä–∏–≤–∞–º–µ –∏—Å—Ç–∏–Ω—Å–∫–∏—è –∏–Ω–ø—É—Ç */
      #audioFiles {
        display: none;
      }

      /* –°—Ç–∏–ª–∏–∑–∏—Ä–∞–º–µ –ª–µ–π–±—ä–ª–∞ –∫–∞—Ç–æ –±—É—Ç–æ–Ω */
      .custom-file-upload {
        display: inline-block;
        padding: 12px 20px;
        cursor: pointer;
        background-color: var(--highlight);
        color: #000;
        border-radius: 8px;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.9rem;
        text-align: center;
        transition: transform 0.1s, background-color 0.2s;
        width: 100%;
        box-sizing: border-box;
      }

      .custom-file-upload:active {
        transform: scale(0.98);
      }

      .custom-file-upload:hover {
        background-color: color-mix(in srgb, var(--highlight) 85%, white);
      }
    </style>
  </head>
  <body>
    <div class="header-row">
      <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è Fitness Timer & DJ</h1>

      <button
        id="themeToggle"
        class="theme-toggle-btn"
        aria-pressed="false"
        aria-label="–ü—Ä–µ–≤–∫–ª—é—á–∏ —Å–≤–µ—Ç–ª–∞/—Ç—ä–º–Ω–∞ —Ç–µ–º–∞"
        title="–°–º—è–Ω–∞ —Ç–µ–º–∞"
      >
        <span class="icon-sun" aria-hidden="true">‚òÄÔ∏è</span>
        <span class="icon-moon" aria-hidden="true">üåô</span>
        <span class="visually-hidden">–°–º—è–Ω–∞ —Ç–µ–º–∞</span>
      </button>
    </div>

    <button class="settings-toggle" onclick="toggleSettings()">
      ‚ò∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    </button>

    <div class="settings" id="settingsPanel">
      <div class="input-group">
        <label>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (—Å–µ–∫)</label>
        <input type="number" id="prepTime" value="10" />
      </div>
      <div class="input-group">
        <label>–†–∞–±–æ—Ç–∞ (—Å–µ–∫)</label>
        <input type="number" id="workTime" value="30" />
      </div>
      <div class="input-group">
        <label>–ü–æ—á–∏–≤–∫–∞ (—Å–µ–∫)</label>
        <input type="number" id="restTime" value="5" />
      </div>
      <div class="input-group">
        <label>–°–µ—Ä–∏–∏ (–±—Ä–æ–π)</label>
        <input type="number" id="sets" value="8" />
      </div>

      <div class="checkbox-group">
        <div class="input-group">
          <label>–û—Ç–±—Ä–æ—è–≤–∞–Ω–µ –≥–ª–∞—Å (—Å–µ–∫)</label>
          <input type="number" id="voiceCountdown" value="5" />
        </div>

        <div class="cb-row">
          <input type="checkbox" id="countBeforeRest" checked />
          <label for="countBeforeRest">–û—Ç–±—Ä–æ—è–≤–∞–π –ø—Ä–µ–¥–∏ –ü–û–ß–ò–í–ö–ê</label>
        </div>
        <div class="cb-row">
          <input type="checkbox" id="countBeforeWork" checked />
          <label for="countBeforeWork">–û—Ç–±—Ä–æ—è–≤–∞–π –ø—Ä–µ–¥–∏ –°–ï–†–ò–Ø (GO)</label>
        </div>
        <div class="cb-row">
          <input type="checkbox" id="stopMusicOnFinish" />
          <label for="stopMusicOnFinish">–°–ø—Ä–∏ –º—É–∑–∏–∫–∞—Ç–∞ –ø—Ä–∏ –§–ò–ù–ê–õ</label>
        </div>
      </div>
    </div>

    <div class="timer-display work-mode" id="timerDisplay">
      <div class="status-text" id="statusText">–ì–û–¢–û–í?</div>
      <div class="time-text" id="timeText">00</div>
      <div class="set-text" id="setText">–°–µ—Ä–∏—è: 0 / 8</div>
      <br />
      <div
        class="progress-container"
        style="
          width: 100%;
          height: 20px;
          background: #333;
          border-radius: 10px;
          margin-bottom: 20px;
          overflow: hidden;
          border: 1px solid #444;
          position: relative;
        "
      >
        <div
          id="progressBar"
          style="
            width: 0%;
            height: 100%;
            background: var(--highlight);
            transition: width 0.3s ease-out;
          "
        ></div>
        <div
          id="progressPercent"
          style="
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            text-align: center;
            font-size: 0.8rem;
            line-height: 20px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
          "
        >
          0%
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn-start" onclick="startTimer()">Start</button>
      <button class="btn-stop" onclick="stopTimer()">Pause</button>
      <button class="btn-reset" onclick="resetTimer()">Reset</button>
    </div>

    <div class="player">
      <h3>üéµ Gym DJ</h3>
      <div class="file-input-wrapper">
        <label for="audioFiles" class="custom-file-upload">
          ‚ûï –î–æ–±–∞–≤–∏ –ø–µ—Å–Ω–∏
        </label>
        
        <input
          type="file"
          id="audioFiles"
          multiple
          accept="audio/*"
          onchange="loadPlaylist()"
        />

        <div style="font-size: 0.8rem; color: #aaa; margin-top: 8px; text-align: center; line-height: 1.4;">
           üí° –ó–∞ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–∏ –ø–µ—Å–Ω–∏ –≥–∏ –¥–æ–±–∞–≤–µ—Ç–µ –æ—Ç –±—É—Ç–æ–Ω–∞ "–ú–æ–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ", "My Files", "Storage".<br>
           –ú–æ–∂–µ—à –¥–∞ –Ω–∞—Ç–∏—Å–∫–∞—à –±—É—Ç–æ–Ω–∞ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ, –∑–∞ –¥–∞ –¥–æ–±–∞–≤—è—à –æ—â–µ –ø–µ—Å–Ω–∏.
        </div>
      </div>

      <div class="now-playing" id="nowPlaying">–ù—è–º–∞ –∏–∑–±—Ä–∞–Ω–∞ –ø–µ—Å–µ–Ω</div>

      <audio
        id="audioPlayer"
        style="width: 100%; height: 30px; margin-top: 10px"
      ></audio>

      <div class="player-controls">
        <button class="player-btn" onclick="playPrev()">‚èÆ</button>
        <!-- <button class="player-btn" onclick="togglePlay()">‚èØ</button> -->
        <button class="player-btn" onclick="playNext()">‚è≠</button>
        <button
          class="player-btn btn-shuffle"
          id="btnShuffle"
          onclick="toggleShuffle()"
        >
          üîÄ
        </button>
      </div>

      <br />

      <ul class="playlist" id="playlist"></ul>
    </div>
	

<script>


      // -------------------------------------------------------
      // 1. –õ–û–ì–í–ê–ù–ï –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (SYSTEM LOGGING)
      // -------------------------------------------------------
      window.addEventListener("load", () => {
        console.log("%c‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –µ –∑–∞—Ä–µ–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ.", "color: green; font-weight: bold; font-size: 14px;");
      });

      window.addEventListener("error", (event) => {
        console.error("‚ùå –ì–ª–æ–±–∞–ª–Ω–∞ –≥—Ä–µ—à–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ:", event.message);
      });

      // -------------------------------------------------------
      // 3. MAIN LOGIC
      // -------------------------------------------------------
      let prepDuration = 10;
      let isPrep = false; 

      let workDuration = 30;
      let restDuration = 5;
      let totalSets = 8;

      let currentSet = 1;
      let currentTime = 0;
      let isWork = true;
      let timerInterval = null;
      let isRunning = false;

      let countdownThreshold = 5;
      let totalWorkoutSeconds = 0;
      let elapsedSeconds = 0;

      // DOM Elements
      const statusText = document.getElementById("statusText");
      const timeText = document.getElementById("timeText");
      const setText = document.getElementById("setText");
      const timerDisplay = document.getElementById("timerDisplay");
      const audioPlayer = document.getElementById("audioPlayer");
      const playlistEl = document.getElementById("playlist");
      const nowPlayingEl = document.getElementById("nowPlaying");

      const cbBeforeRest = document.getElementById("countBeforeRest");
      const cbBeforeWork = document.getElementById("countBeforeWork");

      // Audio Logic
      let isShuffle = false;
      let playlist = [];
      let currentTrackIndex = 0;
      const MAX_VOLUME = 1.0;
      const LOW_VOLUME = 0.2;

      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      function playVictorySound() {
        const t = audioCtx.currentTime;
        const playNote = (freq, time, duration) => {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.type = "triangle";
          osc.frequency.setValueAtTime(freq, time);
          gain.gain.setValueAtTime(0.2, time);
          gain.gain.exponentialRampToValueAtTime(0.001, time + duration);
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.start(time);
          osc.stop(time + duration);
        };

        playNote(523.25, t, 0.4); 
        playNote(659.25, t + 0.1, 0.4); 
        playNote(783.99, t + 0.2, 0.4); 
        playNote(1046.5, t + 0.4, 0.8); 

        const osc2 = audioCtx.createOscillator();
        const gain2 = audioCtx.createGain();
        osc2.type = "sine";
        osc2.frequency.setValueAtTime(1200, t);
        osc2.frequency.linearRampToValueAtTime(2000, t + 0.5);
        gain2.gain.setValueAtTime(0.1, t);
        gain2.gain.linearRampToValueAtTime(0, t + 0.5);
        osc2.connect(gain2);
        gain2.connect(audioCtx.destination);
        osc2.start(t);
        osc2.stop(t + 0.5);
      }

      function loadPlaylist() {
        const fileInput = document.getElementById("audioFiles");
        const newFiles = Array.from(fileInput.files);
        
        if (newFiles.length === 0) {
            console.warn("‚ö†Ô∏è –ù—è–º–∞ –∏–∑–±—Ä–∞–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ.");
            return;
        }

        try {
            playlist = [...playlist, ...newFiles];
            console.log(`üìÇ –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–µ–Ω–∏ ${newFiles.length} —Ñ–∞–π–ª–∞. –û–±—â–æ –ø–µ—Å–Ω–∏: ${playlist.length}`);
            
            renderPlaylistUI();

            if (audioPlayer.src === "" || audioPlayer.paused) {
                const firstNewIndex = playlist.length - newFiles.length;
                loadTrack(firstNewIndex, false);
            }
            fileInput.value = "";
        } catch (error) {
            console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞:", error);
            alert("–í—ä–∑–Ω–∏–∫–Ω–∞ –≥—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ.");
        }
      }

      function renderPlaylistUI() {
        playlistEl.innerHTML = "";
        playlist.forEach((file, index) => {
          const li = document.createElement("li");
          li.innerHTML = `<span>${index + 1}. ${file.name}</span>`;
          li.onclick = () => playTrack(index);
          if (index === currentTrackIndex) li.classList.add("active");
          playlistEl.appendChild(li);
        });
      }

      function loadTrack(index, autoPlay = true) {
        if (index >= playlist.length) index = 0;
        currentTrackIndex = index;

        try {
            const fileUrl = URL.createObjectURL(playlist[index]);
            audioPlayer.src = fileUrl;
            nowPlayingEl.textContent = "‚ñ∂ " + playlist[index].name;
            console.log("üéµ –ó–∞—Ä–µ–¥–µ–Ω–∞ –ø–µ—Å–µ–Ω:", playlist[index].name);

            Array.from(playlistEl.children).forEach((li, i) => {
            li.classList.toggle("active", i === index);
            });

            audioPlayer.onended = () => {
            playNext(); // Changed to playNext to handle shuffle correctly
            };

            if (autoPlay) {
                audioPlayer.play().catch(e => console.error("‚ùå Audio Autoplay failed:", e));
            }
        } catch (err) {
            console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø–µ—Å–µ–Ω:", err);
        }
      }

      function playTrack(index) {
        loadTrack(index, true);
      }

      function setVolume(level) {
        audioPlayer.volume = level;
      }

      function togglePlay() {
        if (playlist.length === 0) return;
        if (audioPlayer.paused) {
          audioPlayer.play();
        } else {
          audioPlayer.pause();
        }
      }

      function toggleShuffle() {
        isShuffle = !isShuffle;
        const btn = document.getElementById("btnShuffle");
        if (isShuffle) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
        console.log("üîÄ Shuffle mode:", isShuffle);
      }

      function playNext() {
        if (playlist.length === 0) return;

        let nextIndex;
        if (isShuffle) {
          do {
            nextIndex = Math.floor(Math.random() * playlist.length);
          } while (playlist.length > 1 && nextIndex === currentTrackIndex);
        } else {
          nextIndex = currentTrackIndex + 1;
          if (nextIndex >= playlist.length) nextIndex = 0;
        }
        playTrack(nextIndex);
      }

      function playPrev() {
        if (playlist.length === 0) return;
        let prevIndex = currentTrackIndex - 1;
        if (prevIndex < 0) prevIndex = playlist.length - 1;
        playTrack(prevIndex);
      }

      function speak(text) {
        if (window.speechSynthesis.speaking) window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "en-US";
        utterance.rate = 1.2;
        window.speechSynthesis.speak(utterance);
      }

      // --- Timer Logic ---
      function updateInputs() {
        workDuration = Math.max(1, parseInt(document.getElementById("workTime").value) || 0);
        restDuration = Math.max(0, parseInt(document.getElementById("restTime").value) || 0);
        totalSets = Math.max(1, parseInt(document.getElementById("sets").value) || 1);
        prepDuration = Math.max(0, parseInt(document.getElementById("prepTime").value) || 0);

        totalWorkoutSeconds = prepDuration + (workDuration + restDuration) * totalSets - restDuration;

        let requestedCountdown = parseInt(document.getElementById("voiceCountdown").value) || 0;
        let minInterval = isPrep && prepDuration > 0
            ? Math.min(workDuration, restDuration || workDuration, prepDuration)
            : Math.min(workDuration, restDuration || workDuration);

        if (requestedCountdown >= minInterval && minInterval > 0) {
          countdownThreshold = minInterval - 1;
        } else {
          countdownThreshold = Math.max(0, requestedCountdown);
        }
        document.getElementById("voiceCountdown").value = countdownThreshold;
      }

      function drawDisplay() {
        timeText.textContent = currentTime;
        setText.textContent = `–°–µ—Ä–∏—è: ${currentSet} / ${totalSets}`;

        const progressPercentValue = Math.min(100, Math.round((elapsedSeconds / totalWorkoutSeconds) * 100)) || 0;

        document.getElementById("progressBar").style.width = progressPercentValue + "%";
        document.getElementById("progressPercent").textContent = progressPercentValue + "%";

        timerDisplay.classList.remove("finished-mode");
        if (isPrep) {
          statusText.textContent = "–ü–û–î–ì–û–¢–û–í–ö–ê";
          timerDisplay.style.borderColor = "var(--highlight)";
        } else if (isWork) {
          statusText.textContent = "GO / –†–ê–ë–û–¢–ê";
          timerDisplay.classList.remove("rest-mode");
          timerDisplay.classList.add("work-mode");
          timerDisplay.style.borderColor = "";
        } else {
          statusText.textContent = "BREAK / –ü–û–ß–ò–í–ö–ê";
          timerDisplay.classList.remove("work-mode");
          timerDisplay.classList.add("rest-mode");
        }
      }

function startTimer() {
        if (isRunning) return;

        // 4. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ª–æ–≥–∏–∫–∞ –Ω–∞ —Ç–∞–π–º–µ—Ä–∞
        if (audioCtx.state === "suspended") audioCtx.resume();
        updateInputs();

        if (playlist.length > 0 && audioPlayer.paused) {
          audioPlayer.play().catch((e) => console.log("Audio play error", e));
        }

        // –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–µ–Ω —Å—Ç–∞—Ä—Ç (–∞–∫–æ –µ –Ω–∞—á–∞–ª–æ)
        if (currentTime === 0 && currentSet === 1 && isWork && !isPrep) {
          if (prepDuration > 0) {
            isPrep = true;
            currentTime = prepDuration;
            speak("Prepare");
          } else {
            currentTime = workDuration;
            speak("Starting Workout");
          }
        }

        isRunning = true;
        drawDisplay();
        console.log("‚è±Ô∏è Timer started");

        // 5. –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (—Ç–æ–≤–∞ –µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–∏—è—Ç setInterval, –∫–æ–π—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞)
        timerInterval = setInterval(() => {
          tick();
        }, 1000);
      }

      function stopTimer(pauseAudio = true) {  
	   clearInterval(timerInterval);
        isRunning = false;
		



		
        console.log("‚è±Ô∏è Timer paused/stopped");

        if (pauseAudio && !audioPlayer.paused) {
          audioPlayer.pause();
        }

        setVolume(MAX_VOLUME);
      }

      function resetTimer() {
		stopTimer();
        elapsedSeconds = 0;
        document.getElementById("progressBar").style.width = "0%";
        document.getElementById("progressPercent").textContent = "0%";
        isWork = true;
        isPrep = true;
        updateInputs();

        currentTime = prepDuration > 0 ? prepDuration : workDuration;
        if (prepDuration <= 0) isPrep = false;

        statusText.textContent = isPrep ? "–ü–û–î–ì–û–¢–û–í–ö–ê" : "–ì–û–¢–û–í?";
        timeText.textContent = currentTime;
        setText.textContent = `–°–µ—Ä–∏—è: 0 / ${totalSets}`;

        timerDisplay.classList.remove("rest-mode", "finished-mode");
        timerDisplay.classList.add("work-mode");

        audioPlayer.pause();
        audioPlayer.currentTime = 0;
        setVolume(MAX_VOLUME);
        console.log("üîÑ Timer reset");
      }

      function tick() {
        elapsedSeconds++;
        currentTime--;
        drawDisplay();

        let shouldCount = false;
        if (isPrep) shouldCount = true; 
        if (isWork && cbBeforeRest.checked) shouldCount = true;
        if (!isWork && cbBeforeWork.checked) shouldCount = true;

        if (currentTime <= countdownThreshold && currentTime > 0 && shouldCount) {
          setVolume(LOW_VOLUME);
          speak(currentTime);
        } else {
          if (audioPlayer.volume !== MAX_VOLUME) {
            setVolume(MAX_VOLUME);
          }
        }

        if (currentTime <= 0) {
          setVolume(LOW_VOLUME);

          if (isPrep) {
            isPrep = false;
            currentTime = workDuration;
            speak("Go");
          } else if (isWork) {
            if (currentSet >= totalSets) {
              currentTime = 0;
              drawDisplay();
              finishWorkout();
              return;
            }
            isWork = false;
            currentTime = restDuration;
            if (cbBeforeRest.checked) speak("Break");
          } else {
            isWork = true;
            currentSet++;
            currentTime = workDuration;
            if (cbBeforeWork.checked) speak("Go");
          }

          setTimeout(() => {
            if (isRunning) setVolume(MAX_VOLUME);
          }, 1200);

          drawDisplay();
        }
      }

      function finishWorkout() {
        stopTimer(false); 
        setVolume(LOW_VOLUME);

        timerDisplay.classList.remove("work-mode", "rest-mode");
        timerDisplay.classList.add("finished-mode");
        statusText.textContent = "–§–ò–ù–ê–õ!";
        console.log("üèÅ Workout finished!");

        playVictorySound();

        setTimeout(() => {
          speak("Workout Complete");
        }, 1500);

        const stopMusic = document.getElementById("stopMusicOnFinish").checked;

        setTimeout(() => {
          if (stopMusic) {
            audioPlayer.pause();
          } else {
            if (!audioPlayer.paused) {
              setVolume(MAX_VOLUME);
            }
          }
        }, 4000);

        isWork = false;
        isPrep = false;
      }

      document.getElementById("timeText").textContent = document.getElementById("workTime").value;

      function toggleSettings() {
        const panel = document.getElementById("settingsPanel");
        panel.classList.toggle("collapsed");
        if (panel.classList.contains("collapsed")) {
          document.getElementById("timerDisplay").scrollIntoView({ behavior: "smooth" });
        }
      }

      const inputIds = ["prepTime", "workTime", "restTime", "sets", "voiceCountdown", "countBeforeRest", "countBeforeWork", "stopMusicOnFinish"];
      inputIds.forEach((id) => {
        const el = document.getElementById(id);
        el.addEventListener("change", () => {
          const val = el.type === "checkbox" ? el.checked : el.value;
          localStorage.setItem("fitness_timer_" + id, val);
        });
      });

      // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ
      window.addEventListener("load", () => {
        inputIds.forEach((id) => {
          const saved = localStorage.getItem("fitness_timer_" + id);
          if (saved !== null) {
            const el = document.getElementById(id);
            if (el.type === "checkbox") el.checked = saved === "true";
            else el.value = saved;
          }
        });
        updateInputs();
        setText.textContent = `–°–µ—Ä–∏—è: 0 / ${totalSets}`;
        timeText.textContent = prepDuration > 0 ? prepDuration : workDuration;
      });

      // Theme logic
      (function () {
        const THEME_KEY = "fitness_theme";
        const btn = document.getElementById("themeToggle");

        function applyTheme(theme) {
          document.body.classList.remove("light-theme", "dark-theme");
          document.body.classList.add(theme === "light" ? "light-theme" : "dark-theme");
          if (btn) {
            const pressed = theme === "light" ? "true" : "false";
            btn.setAttribute("aria-pressed", pressed);
          }
        }

        function detectSystemTheme() {
          try {
            return window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches ? "light" : "dark";
          } catch (e) { return "dark"; }
        }

        function initTheme() {
          let saved = localStorage.getItem(THEME_KEY);
          if (saved !== "light" && saved !== "dark") saved = detectSystemTheme();
          applyTheme(saved);
        }

        function toggleTheme() {
          const isLight = document.body.classList.contains("light-theme");
          const next = isLight ? "dark" : "light";
          applyTheme(next);
          localStorage.setItem(THEME_KEY, next);
        }

        if (btn) {
          btn.addEventListener("click", toggleTheme);
          btn.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              toggleTheme();
            }
          });
        }
        document.addEventListener("DOMContentLoaded", initTheme);
      })();

      function formatTime(s) {
        const mm = Math.floor(s / 60);
        const ss = s % 60;
        return `${String(mm).padStart(2, "0")}:${String(ss).padStart(2, "0")}`;
      }
      timeText.textContent = formatTime(currentTime);
    
	// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ Service Worker –∑–∞ PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then(reg => console.log('Service Worker registered!'))
      .catch(err => console.log('Service Worker failed:', err));
  });
}	
	
	
	
	</script>



  </body>
</html>
